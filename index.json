[{"uri":"https://ethack.github.io/tht/tools/conn-summary/","title":"Conn Summary","tags":[],"description":"","content":"Zeek\u0026rsquo;s conn-summary.log file contains useful information about a network as a whole.\n\u0026gt;== Total === 2018-03-11-23-58-55 - 2018-03-12-00-59-10 - Connections 20.0k - Payload 206.1m - Sampling 1.00% - Ports | Sources | Destinations | Services | Protocols | States | 53 66.0% | 10.55.200.10#1 39.0% | 172.16.200.11#2 18.0% | dns 66.0% | 17 66.0% | SF 78.5% | 443 29.5% | 10.55.200.11#3 23.5% | 165.227.88.15#4 3.0% | ssl 26.0% | 6 34.0% | S0 18.5% | 80 4.5% | 10.55.100.103#5 6.0% | 205.251.196.95#6 2.0% | http 7.5% | | RSTO 2.5% | | 10.55.100.100#7 5.0% | 172.217.4.70#8 2.0% | - 0.5% | | RSTR 0.5% | | 10.55.100.111#9 4.5% | 23.61.199.64#10 2.0% | | | | | 10.55.100.110#11 4.0% | 204.74.101.1#12 1.5% | | | | | 192.168.88.2#13 3.5% | 172.217.4.78#14 1.5% | | | | | 10.55.100.104#15 3.5% | 104.156.80.32#16 1.5% | | | | | 10.55.100.108#17 3.0% | 65.153.18.198#18 1.5% | | | | | 10.55.100.106#19 2.5% | 65.153.18.197#20 1.5% | | | | #1=\u0026lt;???\u0026gt; #2=\u0026lt;???\u0026gt; #3=\u0026lt;???\u0026gt; #4=\u0026lt;???\u0026gt; #5=\u0026lt;???\u0026gt; #6=ns-1119.awsdns-11.org #7=\u0026lt;???\u0026gt; #8=ord37s18-in-f6.1e100.net #9=\u0026lt;???\u0026gt; #10=a7-64.akam.net #11=\u0026lt;???\u0026gt; #12=udns2.ultradns.net #13=\u0026lt;???\u0026gt; #14=lga15s47-in-f78.1e100.net #15=\u0026lt;???\u0026gt; #16=\u0026lt;???\u0026gt; #17=\u0026lt;???\u0026gt; #18=\u0026lt;???\u0026gt; #19=\u0026lt;???\u0026gt; #20=\u0026lt;???\u0026gt; There\u0026rsquo;s a lot to unpack here. Each colum shows the top pieces of information, broken out by percentage of connections. For instance:\nPorts 53 66.0% 443 29.5% 80 4.5% This means that 66.0% of the connections were to port 53, 29.5% were to port 443, and the remaining 4.5% were to port 80. Note that this doesn\u0026rsquo;t specify TCP or UDP. However, the second-to-last column shows that protocol 17 (UDP) was 66.0% of the connections. This happens to match up with the percentage for port 53 so we know that UDP/53 was used.\nProtocols 17 66.0% 6 34.0% Similarly, the following columns break down the percentage of connections by both source and destination IP addresses.\nSources | Destinations 10.55.200.10#1 39.0% | 172.16.200.11#2 18.0% 10.55.200.11#3 23.5% | 165.227.88.15#4 3.0% 10.55.100.103#5 6.0% | 205.251.196.95#6 2.0% 10.55.100.100#7 5.0% | 172.217.4.70#8 2.0% 10.55.100.111#9 4.5% | 23.61.199.64#10 2.0% 10.55.100.110#11 4.0% | 204.74.101.1#12 1.5% 192.168.88.2#13 3.5% | 172.217.4.78#14 1.5% 10.55.100.104#15 3.5% | 104.156.80.32#16 1.5% 10.55.100.108#17 3.0% | 65.153.18.198#18 1.5% 10.55.100.106#19 2.5% | 65.153.18.197#20 1.5% The conn-summary.log file is generated by the trace-summary script. You can also run this script manually and access different options. The script has the ability to generate summaries from either live network data or from Zeek TSV or JSON-formatted conn.log files.\nTHT has a conn-summary script that is useful for generating summaries on the fly for many common use cases. It lets you pipe conn logs into the script. This means you can generate summaries based only on hosts or timeframes you care about.\nfilter 192.168.88.2 165.227.88.15 | conn-summary conn-summary uses trace-summary under the hood, and the output is similar to what we saw above with the following differences:\n Internal to internal traffic is not included. That is, any connections between RFC1918 IP address ranges are excluded. Unlike the Zeek conn-summary.log the data is not sampled by default. This means the statistics presented include all the connections instead of a sample size. The percentages are output twice: once for connections and once for bytes. That means you can see both where the majority of connections went in the top table and where the majority of the data transferred went in the bottom table. The Zeek conn-summary.log includes a bunch of other breakdowns based on different IP address ranges that are not included in the output here.  Connections: ============ \u0026gt;== Total === 2018-01-30-12-14-02 - 2018-01-31-12-14-00 - Connections 239.4k - Payload 35.4m - Ports | Sources | Destinations | Services | Protocols | States | 53 98.8% | 192.168.88.2 100.0% | 165.227.88.15 90.9% | dns 98.8% | 17 100.0% | SF 99.8% | 123 1.2% | 165.227.88.15 0.0% | 208.84.2.53 0.5% | ntp 1.2% | 6 0.0% | S0 0.1% | 443 0.0% | | 208.76.45.53 0.5% | ssl 0.0% | 1 0.0% | REJ 0.0% | 3 0.0% | | 95.101.36.192 0.2% | - 0.0% | | OTH 0.0% | | | 23.211.133.192 0.1% | | | | | | 95.100.173.192 0.1% | | | | | | 95.100.168.194 0.1% | | | | | | 184.85.248.194 0.1% | | | | | | 96.7.49.194 0.1% | | | | | | 208.109.255.2 0.1% | | | | Bytes: ====== \u0026gt;== Total === 2018-01-30-12-14-02 - 2018-01-31-12-14-00 - Connections 239.4k - Payload 35.4m - Ports | Sources | Destinations | Services | Protocols | States | 53 98.3% | 192.168.88.2 100.0% | 165.227.88.15 88.2% | dns 98.3% | 17 99.1% | SF 100.0% | 443 0.9% | 165.227.88.15 0.0% | 162.208.119.40 0.9% | ssl 0.9% | 6 0.9% | OTH 0.0% | 123 0.8% | | 208.76.45.53 0.4% | ntp 0.8% | 1 0.0% | S0 0.0% | 3 0.0% | | 208.84.2.53 0.4% | - 0.0% | | REJ 0.0% | | | 95.101.36.192 0.2% | | | | | | 23.211.133.192 0.2% | | | | | | 95.100.173.192 0.2% | | | | | | 184.85.248.194 0.2% | | | | | | 184.26.161.192 0.2% | | | | | | 95.100.168.194 0.2% | | | | "},{"uri":"https://ethack.github.io/tht/","title":"Threat Hunting Toolkit","tags":[],"description":"","content":""},{"uri":"https://ethack.github.io/tht/tools/","title":"Tools","tags":[],"description":"","content":""},{"uri":"https://ethack.github.io/tht/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://ethack.github.io/tht/tags/","title":"Tags","tags":[],"description":"","content":""}]