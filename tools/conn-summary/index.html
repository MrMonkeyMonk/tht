<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.82.0"><meta name=description content="Threat Hunting Toolkit"><meta name=author content="Ethan Robish & Derek Banks"><link rel=icon href=/tht/images/favicon.png type=image/png><title>Conn Summary :: Threat Hunting Toolkit</title><link href=/tht/css/nucleus.css?1619621436 rel=stylesheet><link href=/tht/css/fontawesome-all.min.css?1619621436 rel=stylesheet><link href=/tht/css/hybrid.css?1619621436 rel=stylesheet><link href=/tht/css/featherlight.min.css?1619621436 rel=stylesheet><link href=/tht/css/perfect-scrollbar.min.css?1619621436 rel=stylesheet><link href=/tht/css/auto-complete.css?1619621436 rel=stylesheet><link href=/tht/css/atom-one-dark-reasonable.css?1619621436 rel=stylesheet><link href=/tht/css/theme.css?1619621436 rel=stylesheet><link href=/tht/css/tabs.css?1619621436 rel=stylesheet><link href=/tht/css/hugo-theme.css?1619621436 rel=stylesheet><link href=/tht/css/theme-blue.css?1619621436 rel=stylesheet><script src=/tht/js/jquery-3.3.1.min.js?1619621436></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style><link href=/tht/css/custom.css?1619621436 rel=stylesheet><link href=/tht/css/highlightjs/rainbow.css?1619621436 rel=stylesheet></head><body data-url=/tht/tools/conn-summary/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><h3>Toolkit</h3></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/tht/js/lunr.min.js?1619621436></script><script type=text/javascript src=/tht/js/auto-complete.js?1619621436></script><script type=text/javascript>var baseurl="https://ethack.github.io/tht/"</script><script type=text/javascript src=/tht/js/search.js?1619621436></script></div><section id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/tht/tools/ title=Tools class="dd-item
parent"><a href=/tht/tools/>Tools
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/tht/tools/conn-summary/ title="Conn Summary" class="dd-item active"><a href=/tht/tools/conn-summary/>Conn Summary
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/ethack/tht/edit/master/docs/content/tools/conn-summary.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/tht/>Threat Hunting Toolkit</a> > <a href=/tht/tools/>Tools</a> > Conn Summary</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Conn Summary</h1><p>Zeek&rsquo;s <code>conn-summary.log</code> file contains useful information about a network as a whole.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>&gt;== Total === 2018-03-11-23-58-55 - 2018-03-12-00-59-10
   - Connections 20.0k - Payload 206.1m - Sampling 1.00% -
     Ports        | Sources                   | Destinations              | Services           | Protocols | States        |
     53     66.0% | 10.55.200.10#1      39.0% | 172.16.200.11#2     18.0% | dns          66.0% | 17  66.0% | SF      78.5% | 
     443    29.5% | 10.55.200.11#3      23.5% | 165.227.88.15#4      3.0% | ssl          26.0% | 6   34.0% | S0      18.5% | 
     80      4.5% | 10.55.100.103#5      6.0% | 205.251.196.95#6     2.0% | http          7.5% |           | RSTO     2.5% | 
                  | 10.55.100.100#7      5.0% | 172.217.4.70#8       2.0% | -             0.5% |           | RSTR     0.5% | 
                  | 10.55.100.111#9      4.5% | 23.61.199.64#10      2.0% |                    |           |               | 
                  | 10.55.100.110#11     4.0% | 204.74.101.1#12      1.5% |                    |           |               | 
                  | 192.168.88.2#13      3.5% | 172.217.4.78#14      1.5% |                    |           |               | 
                  | 10.55.100.104#15     3.5% | 104.156.80.32#16     1.5% |                    |           |               | 
                  | 10.55.100.108#17     3.0% | 65.153.18.198#18     1.5% |                    |           |               | 
                  | 10.55.100.106#19     2.5% | 65.153.18.197#20     1.5% |                    |           |               | 

        #1=&lt;???&gt;  #2=&lt;???&gt;  #3=&lt;???&gt;  
        #4=&lt;???&gt;  #5=&lt;???&gt;  #6=ns-1119.awsdns-11.org  
        #7=&lt;???&gt;  #8=ord37s18-in-f6.1e100.net  #9=&lt;???&gt;  
        #10=a7-64.akam.net  #11=&lt;???&gt;  #12=udns2.ultradns.net  
        #13=&lt;???&gt;  #14=lga15s47-in-f78.1e100.net  #15=&lt;???&gt;  
        #16=&lt;???&gt;  #17=&lt;???&gt;  #18=&lt;???&gt;  
        #19=&lt;???&gt;  #20=&lt;???&gt;  
</code></pre></div><p>There&rsquo;s a lot to unpack here. Each colum shows the top pieces of information, broken out by percentage of connections. For instance:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Ports        
53     66.0% 
443    29.5% 
80      4.5% 
</code></pre></div><p>This means that 66.0% of the connections were to port 53, 29.5% were to port 443, and the remaining 4.5% were to port 80. Note that this doesn&rsquo;t specify TCP or UDP. However, the second-to-last column shows that protocol 17 (UDP) was 66.0% of the connections. This happens to match up with the percentage for port 53 so we know that UDP/53 was used.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Protocols 
17  66.0% 
6   34.0% 
</code></pre></div><p>Similarly, the following columns break down the percentage of connections by both source and destination IP addresses.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Sources                   | Destinations              
10.55.200.10#1      39.0% | 172.16.200.11#2     18.0% 
10.55.200.11#3      23.5% | 165.227.88.15#4      3.0% 
10.55.100.103#5      6.0% | 205.251.196.95#6     2.0% 
10.55.100.100#7      5.0% | 172.217.4.70#8       2.0% 
10.55.100.111#9      4.5% | 23.61.199.64#10      2.0% 
10.55.100.110#11     4.0% | 204.74.101.1#12      1.5% 
192.168.88.2#13      3.5% | 172.217.4.78#14      1.5% 
10.55.100.104#15     3.5% | 104.156.80.32#16     1.5% 
10.55.100.108#17     3.0% | 65.153.18.198#18     1.5% 
10.55.100.106#19     2.5% | 65.153.18.197#20     1.5% 
</code></pre></div><p>The <code>conn-summary.log</code> file is generated by the <a href=https://github.com/zeek/trace-summary><code>trace-summary</code></a> script. You can also run this script manually and access different options. The script has the ability to generate summaries from either live network data or from Zeek TSV or JSON-formatted <code>conn.log</code> files.</p><p>THT has a <code>conn-summary</code> script that is useful for generating summaries on the fly for many common use cases. It lets you pipe conn logs into the script. This means you can generate summaries based only on hosts or timeframes you care about.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>filter 192.168.88.2 165.227.88.15 | conn-summary
</code></pre></div><p><code>conn-summary</code> uses <code>trace-summary</code> under the hood, and the output is similar to what we saw above with the following differences:</p><ul><li>Internal to internal traffic is not included. That is, any connections between RFC1918 IP address ranges are excluded.</li><li>Unlike the Zeek <code>conn-summary.log</code> the data is not sampled by default. This means the statistics presented include all the connections instead of a sample size.</li><li>The percentages are output twice: once for connections and once for bytes. That means you can see both where the majority of connections went in the top table and where the majority of the data transferred went in the bottom table.</li><li>The Zeek <code>conn-summary.log</code> includes a bunch of other breakdowns based on different IP address ranges that are not included in the output here.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Connections:
============

&gt;== Total === 2018-01-30-12-14-02 - 2018-01-31-12-14-00
   - Connections 239.4k - Payload 35.4m - 
     Ports        | Sources                   | Destinations              | Services           | Protocols | States        |
     53     98.8% | 192.168.88.2       100.0% | 165.227.88.15       90.9% | dns          98.8% | 17 100.0% | SF      99.8% | 
     123     1.2% | 165.227.88.15        0.0% | 208.84.2.53          0.5% | ntp           1.2% | 6    0.0% | S0       0.1% | 
     443     0.0% |                           | 208.76.45.53         0.5% | ssl           0.0% | 1    0.0% | REJ      0.0% | 
     3       0.0% |                           | 95.101.36.192        0.2% | -             0.0% |           | OTH      0.0% | 
                  |                           | 23.211.133.192       0.1% |                    |           |               | 
                  |                           | 95.100.173.192       0.1% |                    |           |               | 
                  |                           | 95.100.168.194       0.1% |                    |           |               | 
                  |                           | 184.85.248.194       0.1% |                    |           |               | 
                  |                           | 96.7.49.194          0.1% |                    |           |               | 
                  |                           | 208.109.255.2        0.1% |                    |           |               | 

Bytes:
======

&gt;== Total === 2018-01-30-12-14-02 - 2018-01-31-12-14-00
   - Connections 239.4k - Payload 35.4m - 
     Ports        | Sources                   | Destinations              | Services           | Protocols | States        |
     53     98.3% | 192.168.88.2       100.0% | 165.227.88.15       88.2% | dns          98.3% | 17  99.1% | SF     100.0% | 
     443     0.9% | 165.227.88.15        0.0% | 162.208.119.40       0.9% | ssl           0.9% | 6    0.9% | OTH      0.0% | 
     123     0.8% |                           | 208.76.45.53         0.4% | ntp           0.8% | 1    0.0% | S0       0.0% | 
     3       0.0% |                           | 208.84.2.53          0.4% | -             0.0% |           | REJ      0.0% | 
                  |                           | 95.101.36.192        0.2% |                    |           |               | 
                  |                           | 23.211.133.192       0.2% |                    |           |               | 
                  |                           | 95.100.173.192       0.2% |                    |           |               | 
                  |                           | 184.85.248.194       0.2% |                    |           |               | 
                  |                           | 184.26.161.192       0.2% |                    |           |               | 
                  |                           | 95.100.168.194       0.2% |                    |           |               | 
</code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/tht/tools/ title=Tools><i class="fa fa-chevron-left"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/tht/js/clipboard.min.js?1619621436></script><script src=/tht/js/perfect-scrollbar.min.js?1619621436></script><script src=/tht/js/perfect-scrollbar.jquery.min.js?1619621436></script><script src=/tht/js/jquery.sticky.js?1619621436></script><script src=/tht/js/featherlight.min.js?1619621436></script><script src=/tht/js/highlight.pack.js?1619621436></script><script>hljs.initHighlightingOnLoad()</script><script src=/tht/js/modernizr.custom-3.6.0.js?1619621436></script><script src=/tht/js/learn.js?1619621436></script><script src=/tht/js/hugo-learn.js?1619621436></script><script src=/tht/mermaid/mermaid.js?1619621436></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>